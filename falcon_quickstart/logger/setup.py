import logging
import sys

from loguru import logger

from falcon_quickstart.logger.gunicorn import LOG_LEVEL
from falcon_quickstart.logger.handler import InterceptHandler


def setup_logging():
    intercept_handler = InterceptHandler()
    logging.root.setLevel(LOG_LEVEL)

    seen = set()
    for name in [
        *logging.root.manager.loggerDict.keys(),
        "gunicorn",
        "gunicorn.access",
        "gunicorn.error",
    ]:
        if name not in seen:
            seen.add(name.split(".")[0])
            logging.getLogger(name).handlers = [intercept_handler]

    logger.configure(handlers=[{"sink": sys.stdout, "serialize": False}])
